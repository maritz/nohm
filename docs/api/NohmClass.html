<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>NohmClass - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="NohmClass.html">NohmClass</a><ul class='methods'><li data-type='method'><a href="NohmClass.html#factory">factory</a></li><li data-type='method'><a href="NohmClass.html#getModels">getModels</a></li><li data-type='method'><a href="NohmClass.html#middleware">middleware</a></li><li data-type='method'><a href="NohmClass.html#model">model</a></li><li data-type='method'><a href="NohmClass.html#purgeDb">purgeDb</a></li><li data-type='method'><a href="NohmClass.html#register">register</a></li><li data-type='method'><a href="NohmClass.html#setClient">setClient</a></li><li data-type='method'><a href="NohmClass.html#setPrefix">setPrefix</a></li></ul></li><li><a href="NohmErrors.LinkError.html">LinkError</a></li><li><a href="NohmErrors.ValidationError.html">ValidationError</a></li><li><a href="NohmModel.html">NohmModel</a><ul class='methods'><li data-type='method'><a href="NohmModel.html#allProperties">allProperties</a></li><li data-type='method'><a href="NohmModel.html#belongsTo">belongsTo</a></li><li data-type='method'><a href="NohmModel.html#exists">exists</a></li><li data-type='method'><a href="NohmModel.html#find">find</a></li><li data-type='method'><a href="NohmModel.html#getAll">getAll</a></li><li data-type='method'><a href="NohmModel.html#getDefinitions">getDefinitions</a></li><li data-type='method'><a href="NohmModel.html#link">link</a></li><li data-type='method'><a href="NohmModel.html#load">load</a></li><li data-type='method'><a href="NohmModel.html#numLinks">numLinks</a></li><li data-type='method'><a href="NohmModel.html#property">property</a></li><li data-type='method'><a href="NohmModel.html#propertyDiff">propertyDiff</a></li><li data-type='method'><a href="NohmModel.html#propertyReset">propertyReset</a></li><li data-type='method'><a href="NohmModel.html#remove">remove</a></li><li data-type='method'><a href="NohmModel.html#save">save</a></li><li data-type='method'><a href="NohmModel.html#setUniqueIds">setUniqueIds</a></li><li data-type='method'><a href="NohmModel.html#sort">sort</a></li><li data-type='method'><a href="NohmModel.html#subscribe">subscribe</a></li><li data-type='method'><a href="NohmModel.html#subscribeOnce">subscribeOnce</a></li><li data-type='method'><a href="NohmModel.html#unlink">unlink</a></li><li data-type='method'><a href="NohmModel.html#unlinkAll">unlinkAll</a></li><li data-type='method'><a href="NohmModel.html#unsubscribeEvent">unsubscribeEvent</a></li><li data-type='method'><a href="NohmModel.html#validate">validate</a></li></ul></li><li><a href="NohmStaticModel.html">NohmStaticModel</a><ul class='methods'></ul></li></ul><h3>Namespaces</h3><ul><li><a href="Nohm.html">Nohm</a><ul class='methods'></ul></li><li><a href="NohmErrors.html">NohmErrors</a></li><li><a href="Validators.html">Validators</a><ul class='methods'></ul></li><li></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">NohmClass</h1>
    

    




<section>

<header>
    
        <h2>
        NohmClass
        </h2>
        
    
</header>

<article>
    
        <div class="container-overview">
        
            

    

    <h4 class="name" id="NohmClass"><span class="type-signature"></span>new NohmClass<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="tsOut_index.js.html">tsOut/index.js</a>, <a href="tsOut_index.js.html#line79">line 79</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <p>Main Nohm class. Holds models, generic configuration and can generate the middleware for client validations.</p>
<p>Can be instantiated multiple times if you want different configurations, but usually you only need the default
that is exported as <code>require('nohm').nohm</code>.</p>
</div>









    <h5>Example</h5>
    
    <pre class="prettyprint"><code>// To instantiate another you can do this:
const NohmClass = require('nohm').NohmClass;
const myNohm = new NohmClass({ prefix: 'SomePrefix' });</code></pre>





















        
        </div>
    

    

    

    
    
    

     

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    <h4 class="name" id="factory"><span class="type-signature">(async) </span>factory<span class="signature">(name, id<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {Promise.&lt;<a href="NohmModel.html">NohmModel</a>>}</span></h4>

    




<dl class="details">

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="tsOut_index.js.html">tsOut/index.js</a>, <a href="tsOut_index.js.html#line595">line 595</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <p>Creates a new instance of the model with the given modelName.
When given an id as second parameter it also loads it.</p>
</div>











    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>name</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>Name of the model, must match the modelName of one of your defined models.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>id</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>ID of a record you want to load.</p></td>
        </tr>

    
    </tbody>
</table>














<h5>Throws:</h5>
<ul>
        <li>

<dl>
    <dt>
        <div class="param-desc usertext">
        <p>Rejects when there is no registered model with the given modelName.</p>
        </div>
    </dt>
    <dd></dd>
    <dt>
        <dl class="param-type">
            <dt>
                Type
            </dt>
            <dd>
                
<span class="param-type">Error('Model %name not found.')</span>


            </dd>
        </dl>
    </dt>
    <dd></dd>
</dl>

</li>
    
        <li>

<dl>
    <dt>
        <div class="param-desc usertext">
        <p>If no record exists of the given id,
an error is thrown with the message 'not found'</p>
        </div>
    </dt>
    <dd></dd>
    <dt>
        <dl class="param-type">
            <dt>
                Type
            </dt>
            <dd>
                
<span class="param-type">Error('not found')</span>


            </dd>
        </dl>
    </dt>
    <dd></dd>
</dl>

</li>
    </ul>


<h5>Returns:</h5>

        


<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;<a href="NohmModel.html">NohmModel</a>></span>


    </dd>
</dl>

    



        
            

    

    <h4 class="name" id="getModels"><span class="type-signature"></span>getModels<span class="signature">()</span><span class="type-signature"> &rarr; {Array.&lt;NohmModelStatic>}</span></h4>

    




<dl class="details">

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="tsOut_index.js.html">tsOut/index.js</a>, <a href="tsOut_index.js.html#line580">line 580</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <p>Get all model classes that are registered via .register() or .model()</p>
</div>

























<h5>Returns:</h5>

        


<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Array.&lt;NohmModelStatic></span>


    </dd>
</dl>

    



        
            

    

    <h4 class="name" id="middleware"><span class="type-signature"></span>middleware<span class="signature">(options)</span><span class="type-signature"> &rarr; {Middleware~callback}</span></h4>

    




<dl class="details">

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="tsOut_middleware.js.html">tsOut/middleware.js</a>, <a href="tsOut_middleware.js.html#line154">line 154</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="https://maritz.github.io/nohm/#browser-validation">https://maritz.github.io/nohm/#browser-validation</a></li>
        </ul>
    </dd>
    

    
</dl>





<div class="description usertext">
    <p>Returns a middleware that can deliver the validations as a javascript file
and the modelspecific validations as a JSON object to the browser.
This is useful if you want to save some bandwith by doing the validations
in the browser before saving to the server.</p>
<p>Example:</p>
<pre class="prettyprint source"><code>   server.use(nohm.middleware(
     // options object
     {
       url: '/nohm.js',
       namespace: 'nohm',
       exclusions: {

         User: { // modelName

           // this will ignore the second validation in the validation definition array for
           // the property 'name' in the model definition
           name: [false, true],

           // this will completely ignore all validations for the salt property
           salt: true
         },

         Privileges: true // this will completely ignore the Priviledges model
       }
     }
   ));
</code></pre>
</div>











    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last"><p>Options for the middleware</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>url</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    <code>'/nomValidations.js'</code>
                
                </td>
            

            <td class="description last"><p>Url under which the js file will be available.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>exclusions</code></td>
            

            <td class="type">
            
                
<span class="param-type">object.&lt;string, (object|boolean)></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    <code>{}</code>
                
                </td>
            

            <td class="description last"><p>Object containing exclusions for the
validations export - see example for details</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>namespace</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    <code>'nomValidations'</code>
                
                </td>
            

            <td class="description last"><p>Namespace to be used by the js file in the browser.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>extraFiles</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    <code>[]</code>
                
                </td>
            

            <td class="description last"><p>Extra files containing validations.
You should only use this if they are not already set via Nohm.setExtraValidations
as this automatically includes those.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>maxAge</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    <code>3600</code>
                
                </td>
            

            <td class="description last"><p>Cache control in seconds. (Default is one hour)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>uglify</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    <code>false</code>
                
                </td>
            

            <td class="description last"><p>True to enable minification.
Requires uglify-js to be installed in your project!</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>
















<h5>Returns:</h5>

        


<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Middleware~callback</span>


    </dd>
</dl>

    



        
            

    

    <h4 class="name" id="model"><span class="type-signature"></span>model<span class="signature">(modelName, options, temp)</span><span class="type-signature"> &rarr; {<a href="NohmStaticModel.html">NohmStaticModel</a>}</span></h4>

    




<dl class="details">

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="tsOut_index.js.html">tsOut/index.js</a>, <a href="tsOut_index.js.html#line166">line 166</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <p>Creates and returns a new model class with the given name and options.
If you're using Typescript it is strongly advised to use Nohm.register() instead.</p>
</div>











    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>modelName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Name of the model. This needs to be unique and is used in data storage.
Thus <b>changing this will invalidate existing data</b>!</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">IModelDefinitions</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>This is an object containing the actual model definitions.
These are: properties, methods (optional) and the client (optional) to be used.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>temp</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            
                <td class="default">
                
                    <code>false</code>
                
                </td>
            

            <td class="description last"><p>When true, this model is not added to the internal model cache,
meaning methods like factory() and getModels() cannot access them.
This is mostly useful for meta things like migrations.</p></td>
        </tr>

    
    </tbody>
</table>
















<h5>Returns:</h5>

        


<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="NohmStaticModel.html">NohmStaticModel</a></span>


    </dd>
</dl>

    



        
            

    

    <h4 class="name" id="purgeDb"><span class="type-signature">(async) </span>purgeDb<span class="signature">(client<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="tsOut_index.js.html">tsOut/index.js</a>, <a href="tsOut_index.js.html#line625">line 625</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <p>DO NOT USE THIS UNLESS YOU ARE ABSOLUTELY SURE ABOUT IT!</p>
<p>Deletes any keys from the db that start with the set nohm prefixes.</p>
<p>DO NOT USE THIS UNLESS YOU ARE ABSOLUTELY SURE ABOUT IT!</p>
</div>











    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>client</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>You can specify the redis client to use. Default: Nohm.client</p></td>
        </tr>

    
    </tbody>
</table>



















        
            

    

    <h4 class="name" id="register"><span class="type-signature"></span>register<span class="signature">(subClass, temp)</span><span class="type-signature"> &rarr; {<a href="NohmStaticModel.html">NohmStaticModel</a>}</span></h4>

    




<dl class="details">

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="tsOut_index.js.html">tsOut/index.js</a>, <a href="tsOut_index.js.html#line413">line 413</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <p>Creates, registers and returns a new model class from a given class.
When using Typescript this is the preferred method of creating new models over using Nohm.model().</p>
</div>









    <h5>Example</h5>
    
    <pre class="prettyprint"><code>// Typescript
  import { Nohm, NohmModel, TTypedDefinitions } from 'nohm';

  // this interface is useful for having typings in .property() and .allProperties() etc. but is optional
  interface IUserModelProps {
   name: string;
  }

  class UserModelClass extends NohmModel&lt;IUserModelProps> {
    protected static modelName = 'user'; // used in redis to store the keys

    // the TTypedDefinitions generic makes sure that our definitions have the same keys as
    // defined in our property interface.
    // If you don't want to use the generic, you have to use the exported {type}Property types
    // to get around the tsc throwing an error.
    // TODO: look into the error thrown by tsc when leaving out TTypedDefinitions and using 'sometype' as type
    protected static definitions: TTypedDefinitions&lt;IUserModelProps> = {
      name: {
        defaultValue: 'testName',
        type: 'string', // you have to manually make sure this matches the IUserModelProps type!
        validations: [
          'notEmpty',
        ],
      },
    };
    public async foo() {
      const test = bar.property('name'); // no error and test typed to string

      await bar.validate();
      bar.errors.name; // no error and typed

      // accessing unknown props does not work,
      // because we specified that UserModel only has properties of IUserModelProps
      bar.property('foo'); // typescript errors
      bar.errors.foo; // typescript error
    };
  }
  const userModel = Nohm.register(UserModelClass);
  // typescript now knows about bar.foo() and all the standard nohm methods like bar.property();
  const bar = new userModel();
  bar.foo(); // no error
  bar.allProperties().name === 'testName'; // no error</code></pre>




    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>subClass</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="NohmModel.html">NohmModel</a></span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Complete model class, needs to extend NohmModel.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>temp</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            
                <td class="default">
                
                    <code>false</code>
                
                </td>
            

            <td class="description last"><p>When true, this model is not added to the internal model cache,
meaning methods like factory() and getModels() cannot access them.
This is mostly useful for meta things like migrations.</p></td>
        </tr>

    
    </tbody>
</table>
















<h5>Returns:</h5>

        


<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="NohmStaticModel.html">NohmStaticModel</a></span>


    </dd>
</dl>

    



        
            

    

    <h4 class="name" id="setClient"><span class="type-signature"></span>setClient<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="tsOut_index.js.html">tsOut/index.js</a>, <a href="tsOut_index.js.html#line128">line 128</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <p>Set the Nohm global redis client.
Note: this will not affect models that have a client set on their own.</p>
</div>




























        
            

    

    <h4 class="name" id="setPrefix"><span class="type-signature"></span>setPrefix<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="tsOut_index.js.html">tsOut/index.js</a>, <a href="tsOut_index.js.html#line120">line 120</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <p>Set the Nohm global redis client.
Note: this will not affect models that have a client set on their own.</p>
</div>




























        
    

    

    
</article>

</section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>